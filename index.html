<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gadgethub</title>
    <meta name="description" content="Lovable Generated Project" />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="aurum-mobile-boutique" />
    <meta property="og:description" content="Lovable Generated Project" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module">
      
  // Supabase client already injected by Cursor or Lovable (no need for keys)
  const { supabase } = window;

  const chatInput = document.getElementById("chatInput");
  const sendBtn = document.getElementById("sendBtn");
  const messages = document.getElementById("messages");

  let userId = null;

  // Get logged-in user ID
  const getUser = async () => {
    const { data: { user }, error } = await supabase.auth.getUser();
    if (user) {
      userId = user.id;
    } else {
      console.error("User not logged in", error);
    }
  };
  await getUser();

  // Send message to Supabase
  async function sendMessage() {
  const messageText = chatInput.value.trim();
  if (messageText === '' || !userId) return;

  const { error } = await supabase.from("messages").insert([
    {
      message: messageText,
      sender_id: userId // ðŸ‘ˆ You MUST include this if no default in DB
    }
  ]);

  if (error) {
    console.error("Error sending message:", error.message);
    return;
  }

  // (rest of your code for showing the message in the UI)
}

    // Show sent message in chat box
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('flex', 'justify-end', 'mb-3');

    const messageContent = document.createElement('div');
    messageContent.classList.add('max-w-xs', 'bg-blue-500', 'text-white', 'p-3', 'rounded-lg', 'shadow-sm');

    const messageP = document.createElement('p');
    messageP.classList.add('text-sm');
    messageP.textContent = messageText;

    const timestamp = document.createElement('span');
    timestamp.classList.add('text-xs', 'text-blue-100', 'mt-1', 'block');
    timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    messageContent.appendChild(messageP);
    messageContent.appendChild(timestamp);
    messageDiv.appendChild(messageContent);

    messages.appendChild(messageDiv);
    chatInput.value = '';
    messages.scrollTop = messages.scrollHeight;
  

  // Listen to button click
  sendBtn.addEventListener("click", sendMessage);

  // Also allow Enter key to send message
  chatInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });

  // Listen for incoming messages (from others/admin)
  supabase
    .channel('public:messages')
    .on('postgres_changes', {
      event: 'INSERT',
      schema: 'public',
      table: 'messages'
    }, (payload) => {
      const msg = payload.new;
      if (msg.sender_id !== userId) {
        addIncomingMessage(msg.message);
      }
    })
    .subscribe();

  // Function to show incoming message
  function addIncomingMessage(text) {
    const messageDiv = document.createElement('div');
    messageDiv.classList.add('flex', 'justify-start', 'mb-3');

    const messageContent = document.createElement('div');
    messageContent.classList.add('max-w-xs', 'bg-white', 'p-3', 'rounded-lg', 'shadow-sm', 'border');

    const messageP = document.createElement('p');
    messageP.classList.add('text-sm', 'text-gray-800');
    messageP.textContent = text;

    const timestamp = document.createElement('span');
    timestamp.classList.add('text-xs', 'text-gray-500', 'mt-1', 'block');
    timestamp.textContent = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

    messageContent.appendChild(messageP);
    messageContent.appendChild(timestamp);
    messageDiv.appendChild(messageContent);

    messages.appendChild(messageDiv);
    messages.scrollTop = messages.scrollHeight;
  
  }

    </script>
    
  </body>
</html>
  